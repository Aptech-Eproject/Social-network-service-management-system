services:
  # ============================================
  # üö™ API GATEWAY - Public
  # ============================================
  api-gateway:
    image: minhtri269/snms-api-gateway:dev-latest
    container_name: snms-gateway-dev
    ports:
      - "8000:8000"
    
    # Mount source files only
    volumes:
      - ../../backend/api-gateway/Program.cs:/app/Program.cs:ro
      
      # Mount config files
      - ../../backend/api-gateway/appsettings.json:/app/appsettings.json:ro
      - ../../backend/api-gateway/appsettings.Development.json:/app/appsettings.Development.json:ro
      
      # Named volumes for build outputs
      - gateway_bin:/app/bin
      - gateway_obj:/app/obj
      
      # NOT mounted: *.csproj (in image)
      # NOT mounted: NuGet packages (in image)
    
    env_file:
      - ../../backend/api-gateway/.env
    
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8000
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
    
    command: dotnet watch run --no-launch-profile
    
    depends_on:
      - user-service
      - social-service
    
    networks:
      - snms-network
    
    restart: unless-stopped

  # ============================================
  # üë§ USER SERVICE - Internal
  # ============================================
  user-service:
    image: minhtri269/snms-user-service:dev-latest
    container_name: snms-user-dev
    expose:
      - "8081"
    
    # Mount source files only
    volumes:
      - ../../backend/user-service/Program.cs:/app/Program.cs:ro
      
      # Mount config files
      - ../../backend/user-service/appsettings.json:/app/appsettings.json:ro
      - ../../backend/user-service/appsettings.Development.json:/app/appsettings.Development.json:ro
      
      # Named volumes for build outputs
      - user_bin:/app/bin
      - user_obj:/app/obj
      
      # NOT mounted: *.csproj (in image)
    
    env_file:
      - ../../backend/user-service/.env
    
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8081
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
    
    command: dotnet watch run --no-launch-profile
    
    networks:
      - snms-network
    
    restart: unless-stopped

  # ============================================
  # üåê SOCIAL SERVICE - Internal
  # ============================================
  social-service:
    image: minhtri269/snms-social-service:dev-latest
    container_name: snms-social-dev
    expose:
      - "8082"
    
    # Mount source files only
    volumes:
      - ../../backend/social-service/Program.cs:/app/Program.cs:ro
      
      # Mount config files
      - ../../backend/social-service/appsettings.json:/app/appsettings.json:ro
      - ../../backend/social-service/appsettings.Development.json:/app/appsettings.Development.json:ro
      
      # Named volumes for build outputs
      - social_bin:/app/bin
      - social_obj:/app/obj
    
    env_file:
      - ../../backend/social-service/.env
    
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8082
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
    
    command: dotnet watch run --no-launch-profile
    
    networks:
      - snms-network
    
    restart: unless-stopped

networks:
  snms-network:
    driver: bridge
    name: snms-dev-network

volumes:
  gateway_bin:
  gateway_obj:
  user_bin:
  user_obj:
  social_bin:
  social_obj:
