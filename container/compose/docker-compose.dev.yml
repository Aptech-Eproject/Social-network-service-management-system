services:
  # ============================================
  # üö™ API GATEWAY - Public
  # ============================================
  api-gateway:
    image: minhtri269/snms-api-gateway:dev-latest
    container_name: snms-gateway-dev
    ports:
      - "8000:8000"
    volumes:
      - ../../backend/api-gateway:/app
      - gateway_bin:/app/bin
      - gateway_obj:/app/obj

    env_file:
      - ../../backend/api-gateway/.env

    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8000
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"

    command: dotnet watch --project *.csproj run --no-launch-profile
    depends_on:
      - user-service
      - social-service
    
    networks:
      - snms-network
    
    restart: unless-stopped

  # ============================================
  # üë§ USER SERVICE - Internal
  # ============================================
  user-service:
    image: minhtri269/snms-user-service:dev-latest
    container_name: snms-user-dev
    expose:
      - "8081"
    volumes:
      - ../../backend/user-service:/app
      - user_bin:/app/bin
      - user_obj:/app/obj
      
    env_file:
      - ../../backend/user-service/.env
    
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8081
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
    
    command: dotnet watch --project *.csproj run --no-launch-profile
    
    networks:
      - snms-network
    
    restart: unless-stopped

  # ============================================
  # üåê SOCIAL SERVICE - Internal
  # ============================================
  social-service:
    image: minhtri269/snms-social-service:dev-latest
    container_name: snms-social-dev
    expose:
      - "8082"
    volumes:
      - ../../backend/social-service:/app
      - social_bin:/app/bin
      - social_obj:/app/obj
    
    env_file:
      - ../../backend/social-service/.env
    
    environment:
      ASPNETCORE_ENVIRONMENT: Development
      ASPNETCORE_URLS: http://+:8082
      DOTNET_USE_POLLING_FILE_WATCHER: "true"
      DOTNET_WATCH_RESTART_ON_RUDE_EDIT: "true"
    
    command: dotnet watch --project *.csproj run --no-launch-profile
    
    networks:
      - snms-network
    
    restart: unless-stopped

  # ============================================
  # üß† REDIS - Cache 
  # ============================================
  redis:
    image: redis:7-alpine
    container_name: snms-redis-dev
    ports:
      - "6379:6379"          
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes
    networks:
      - snms-network
    restart: unless-stopped

networks:
  snms-network:
    driver: bridge
    name: snms-dev-network

volumes:
  gateway_bin:
  gateway_obj:
  user_bin:
  user_obj:
  social_bin:
  social_obj:
  redis_data:
